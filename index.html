<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì œëª©ì—†ëŠ” RPG ê°€ì¹˜í‘œ | ê°•ë°©ê¶Œ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { background:#111; color:#eee; font-family:Arial; padding:20px; }
h1,h2 { text-align:center; }
input,textarea,button {
    width:100%; padding:10px; margin:5px 0;
    background:#222; color:#eee; border:1px solid #444;
}
button { cursor:pointer; }
table { width:100%; border-collapse:collapse; }
th,td { border:1px solid #444; padding:8px; text-align:center; }
.hidden { display:none; }
.comment { border:1px solid #333; padding:10px; margin:10px 0; background:#1a1a1a; }
.comment strong { color:#6cf; }
.top { display:flex; gap:5px; }
</style>
</head>

<body>

<h1>ì œëª©ì—†ëŠ” RPG ê°€ì¹˜í‘œ</h1>

<!-- ===== ë¡œê·¸ì¸ ===== -->
<div id="authBox">
  <input id="email" placeholder="ì´ë©”ì¼">
  <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <div class="top">
    <button onclick="signup()">íšŒì›ê°€ì…</button>
    <button onclick="login()">ë¡œê·¸ì¸</button>
    <button onclick="logout()" id="logoutBtn" class="hidden">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
  <p id="userInfo">ë¡œê·¸ì¸ ì•ˆ ë¨</p>
</div>

<hr>

<!-- ===== ê°€ì¹˜í‘œ ===== -->
<input id="search" placeholder="ì•„ì´í…œ ê²€ìƒ‰" onkeyup="filterItems()">

<table>
<thead>
<tr>
<th>ì•„ì´í…œ</th><th>ìˆ˜ëŸ‰</th><th>ê°•ë°©ê¶Œ ê°€ì¹˜</th><th>ë¹„ê³ </th>
</tr>
</thead>
<tbody id="itemTable"></tbody>
</table>

<hr>

<!-- ===== ëŒ“ê¸€ ===== -->
<h2>ğŸ’¬ ëŒ“ê¸€ (ë¡œê·¸ì¸ í•„ìˆ˜)</h2>
<textarea id="commentText" placeholder="ë¡œê·¸ì¸ í›„ ëŒ“ê¸€ ì‘ì„± ê°€ëŠ¥"></textarea>
<button onclick="addComment()">ëŒ“ê¸€ ì‘ì„±</button>
<div id="commentList"></div>

<!-- ===== Firebase SDK ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”´ ì—¬ê¸°ì— ë„¤ Firebase ì„¤ì • ë¶™ì—¬ë„£ê¸° */
const firebaseConfig = {
  apiKey: "ì—¬ê¸°ì—_ë„£ì–´",
  authDomain: "ì—¬ê¸°ì—_ë„£ì–´",
  projectId: "ì—¬ê¸°ì—_ë„£ì–´",
  storageBucket: "ì—¬ê¸°ì—_ë„£ì–´",
  messagingSenderId: "ì—¬ê¸°ì—_ë„£ì–´",
  appId: "ì—¬ê¸°ì—_ë„£ì–´"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

/* ===== ì•„ì´í…œ ===== */
const items = [
 ["ë‹¤ì´ì•„","12~15","1",""],
 ["ë§ˆê·¸ë§ˆ ì½”ì–´","2","1",""],
 ["íƒœì´ˆì˜ ë¹›","1","4",""],
 ["ë‚™í™”ì°¸(ìŠ¤í‚¬)","1","110++",""],
 ["ê²€ê¸°(ìŠ¤í‚¬)","1","150+++","ì¶”ì •"],
 ["ì•„ì´ìŠ¤í”½(ìŠ¤í‚¬)","1","100+","ì¶”ì •"]
];

const table = document.getElementById("itemTable");
function renderTable(data){
  table.innerHTML="";
  data.forEach(i=>{
    const tr=document.createElement("tr");
    i.forEach(t=>{
      const td=document.createElement("td");
      td.textContent=t;
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });
}
renderTable(items);

function filterItems(){
  const k=search.value.toLowerCase();
  renderTable(items.filter(i=>i[0].toLowerCase().includes(k)));
}

/* ===== ë¡œê·¸ì¸ ===== */
window.signup = () => {
  createUserWithEmailAndPassword(auth,email.value,password.value)
    .then(()=>alert("íšŒì›ê°€ì… ì™„ë£Œ"))
    .catch(e=>alert(e.message));
};

window.login = () => {
  signInWithEmailAndPassword(auth,email.value,password.value)
    .catch(e=>alert(e.message));
};

window.logout = () => signOut(auth);

onAuthStateChanged(auth,user=>{
  if(user){
    userInfo.textContent=`ë¡œê·¸ì¸: ${user.email}`;
    logoutBtn.classList.remove("hidden");
  }else{
    userInfo.textContent="ë¡œê·¸ì¸ ì•ˆ ë¨";
    logoutBtn.classList.add("hidden");
  }
});

/* ===== ëŒ“ê¸€ ===== */
window.addComment = async () => {
  if(!auth.currentUser){
    alert("ë¡œê·¸ì¸ í›„ ì‘ì„± ê°€ëŠ¥");
    return;
  }
  if(!commentText.value.trim()) return;

  await addDoc(collection(db,"comments"),{
    user: auth.currentUser.email,
    text: commentText.value,
    time: serverTimestamp()
  });
  commentText.value="";
};

const q = query(collection(db,"comments"),orderBy("time","desc"));
onSnapshot(q,snap=>{
  commentList.innerHTML="";
  snap.forEach(doc=>{
    const d=doc.data();
    commentList.innerHTML+=`
      <div class="comment">
        <strong>${d.user}</strong><br>${d.text}
      </div>`;
  });
});
</script>

</body>
</html>
