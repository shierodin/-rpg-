<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì œëª©ì—†ëŠ” RPG ê°€ì¹˜í‘œ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { background:#111; color:#eee; font-family:Arial; padding:20px; }
h1,h2 { text-align:center; }
input,textarea,button {
  width:100%; padding:10px; margin:6px 0;
  background:#222; color:#eee; border:1px solid #444;
}
button { cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th,td { border:1px solid #444; padding:8px; text-align:center; }
th { background:#222; }
.comment {
  border:1px solid #333;
  padding:10px;
  margin:10px 0;
  background:#1a1a1a;
}
.comment strong { color:#6cf; }
.comment time { font-size:12px; color:#aaa; }
.hidden { display:none; }
</style>
</head>

<body>

<h1>ì œëª©ì—†ëŠ” RPG ê°€ì¹˜í‘œ</h1>

<h2>ğŸ” ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>
<input id="nick" placeholder="ë‹‰ë„¤ì„">
<input id="pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
<button onclick="signup()">íšŒì›ê°€ì…</button>
<button onclick="login()">ë¡œê·¸ì¸</button>
<button onclick="logout()" id="logoutBtn" class="hidden">ë¡œê·¸ì•„ì›ƒ</button>
<p id="loginState">ë¡œê·¸ì¸ ì•ˆ ë¨</p>

<hr>

<input id="search" placeholder="ì•„ì´í…œ ê²€ìƒ‰" onkeyup="filterItems()">

<table>
<thead>
<tr>
<th>ì•„ì´í…œ</th><th>ìˆ˜ëŸ‰</th><th>ê°•ë°©ê¶Œ ê°€ì¹˜</th><th>ë¹„ê³ </th>
</tr>
</thead>
<tbody id="itemTable"></tbody>
</table>

<hr>

<h2>ğŸ’¬ ëŒ“ê¸€ (ë°•ì œ / ì‹¤ì‹œê°„)</h2>
<textarea id="commentText" placeholder="ë¡œê·¸ì¸ í›„ ì‘ì„± ê°€ëŠ¥"></textarea>
<button id="commentBtn" onclick="addComment()">ëŒ“ê¸€ ì‘ì„±</button>
<div id="commentList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs,
  query, where, onSnapshot, orderBy, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ğŸ”´ Firebase ì„¤ì • */
const firebaseConfig = {
  apiKey: "ì—¬ê¸°ì—",
  authDomain: "ì—¬ê¸°ì—",
  projectId: "ì—¬ê¸°ì—",
  storageBucket: "ì—¬ê¸°ì—",
  messagingSenderId: "ì—¬ê¸°ì—",
  appId: "ì—¬ê¸°ì—"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore();

/* ===== ë¡œê·¸ì¸ ìƒíƒœ ë³µì› ===== */
let currentUser = localStorage.getItem("LOGIN_USER");
const state = document.getElementById("loginState");
const logoutBtn = document.getElementById("logoutBtn");
const commentBtn = document.getElementById("commentBtn");

function refreshLoginUI() {
  if (currentUser) {
    state.textContent = "ë¡œê·¸ì¸: " + currentUser;
    logoutBtn.classList.remove("hidden");
    commentBtn.disabled = false;
  } else {
    state.textContent = "ë¡œê·¸ì¸ ì•ˆ ë¨";
    logoutBtn.classList.add("hidden");
    commentBtn.disabled = true;
  }
}
refreshLoginUI();

/* íšŒì›ê°€ì… */
window.signup = async () => {
  const n = nick.value.trim();
  const p = pw.value.trim();
  if (!n || !p) return alert("ì…ë ¥í•´ë¼");

  const q = query(collection(db,"users"), where("nick","==",n));
  if (!(await getDocs(q)).empty) return alert("ì´ë¯¸ ì¡´ì¬");

  await addDoc(collection(db,"users"), { nick:n, pw:p });
  alert("íšŒì›ê°€ì… ì™„ë£Œ");
};

/* ë¡œê·¸ì¸ */
window.login = async () => {
  const q = query(
    collection(db,"users"),
    where("nick","==",nick.value.trim()),
    where("pw","==",pw.value.trim())
  );
  if ((await getDocs(q)).empty) return alert("ì‹¤íŒ¨");

  currentUser = nick.value.trim();
  localStorage.setItem("LOGIN_USER", currentUser);
  refreshLoginUI();
};

/* ë¡œê·¸ì•„ì›ƒ */
window.logout = () => {
  localStorage.removeItem("LOGIN_USER");
  currentUser = null;
  refreshLoginUI();
};

/* ===== ê°€ì¹˜í‘œ ===== */
const items = [
 ["ë‹¤ì´ì•„","12~15","1",""],
 ["ë§ˆê·¸ë§ˆ ì½”ì–´","2","1",""],
 ["íƒœì´ˆì˜ ì „ê¸°","1","1",""],
 ["íƒœì´ˆì˜ ì•”ì„","1","1+",""],
 ["íƒœì´ˆì˜ ë¹›","1","4","ì´ì„¸ê³„ 2~3"],
 ["íƒœì´ˆì˜ ê´‘ì„","1","5+","ì´ì„¸ê³„ 2~3"],
 ["ì•Œ ìˆ˜ ì—†ëŠ” ìŠ¤í‚¬","1","5+","ì´ì„¸ê³„ 3"],
 ["ì•Œ ìˆ˜ ì—†ëŠ” ì¢…ì´","1","3+","ì´ì„¸ê³„ 1~3"],
 ["ëˆ","1m","5+",""],
 ["ë§ˆë‚˜ì„","100+","1",""],
 ["ë§ˆë‚˜ì •ìˆ˜","10~15","1",""],
 ["ì¡°í™”ì„","8+","1",""],
 ["ìš©ë ¥ì„","1","17+",""],
 ["ì €ì£¼í•µ","1","4",""],
 ["ì˜¤ë˜ëœ ì €ì£¼ ê»ë°ê¸°","1","14+",""],
 ["ì €ì£¼","80~100","1",""],
 ["ì±„êµ´ì˜ ì •ì„(ìŠ¤í‚¬)","1","12+",""],
 ["ì¼ì  ì§‘ì¤‘(ìŠ¤í‚¬)","1","3+",""],
 ["ë²šê½ƒ","40~50","1",""],
 ["íŒŒë¼ë‹¤ì´ìŠ¤ ìˆ˜ì¥ì˜ ì¸ì •","1","7++",""],
 ["ë‚™í™”ì°¸(ìŠ¤í‚¬)","1","110++",""],
 ["íšŒì „ ì°¸ìˆ˜(ìŠ¤í‚¬)","1","50++",""],
 ["í”„ë¡œìŠ¤íŠ¸ ì •ìˆ˜","1","2",""],
 ["í•œì² ","1","40",""],
 ["ê²€ê¸°(ìŠ¤í‚¬)","1","150+++","ì¶”ì •"],
 ["ì—í…Œë¥´","1","3",""],
 ["í™©ê¸ˆ ë§ê°ì˜ ìŠ¤í”„","1","7++",""],
 ["í™©í˜¼ì˜ íŒŒí¸","1","5",""],
 ["ì¿ë¹› ì‹¬ì¥ì„","1","5",""],
 ["ì‹¬í™ì˜ ì²­ìˆ˜","1","17++",""]
];

const table = document.getElementById("itemTable");
function renderTable(d){
  table.innerHTML="";
  d.forEach(r=>{
    const tr=document.createElement("tr");
    r.forEach(c=>{
      const td=document.createElement("td");
      td.textContent=c;
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });
}
renderTable(items);

window.filterItems=()=>{
  const k=search.value.toLowerCase();
  renderTable(items.filter(i=>i[0].toLowerCase().includes(k)));
};

/* ===== ëŒ“ê¸€ ë°•ì œ ===== */
window.addComment = async () => {
  if (!currentUser) return;

  const text = commentText.value.trim();
  if (!text) return;

  const fixedTime = new Date().toLocaleString("ko-KR");

  await addDoc(collection(db,"comments"), {
    user: currentUser,
    text,
    fixedTime,
    time: serverTimestamp()
  });
  commentText.value="";
};

const cq = query(collection(db,"comments"), orderBy("time","desc"));
onSnapshot(cq, snap=>{
  commentList.innerHTML="";
  snap.forEach(d=>{
    const c=d.data();
    commentList.innerHTML += `
      <div class="comment">
        <strong>${c.user}</strong>
        <time> (${c.fixedTime})</time><br>
        ${c.text}
      </div>`;
  });
});
</script>

</body>
</html>
